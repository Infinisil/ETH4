<h1 id="operating-systems">Operating Systems</h1>
<h2 id="roles-of-the-os">Roles of the OS</h2>
<h3 id="referee">Referee</h3>
<p>Controls/orchestrates/shares access to resources and hardware by multiplexing. Used for CPU, memory, devices and more. Needs to protect applications from each other through memory, CPU, etc. Must still allow communication. Fairness, no starving and everybody makes progress. Be efficient while doing all of that and guarantee real-time performance.</p>
<h3 id="illusionist">Illusionist</h3>
<p>Creates illusion of real resources which seem to be physical but are simpler, larger, better. Used for processor, storage, network, links, etc. virtual memory, virtual machines, files, windows are examples.</p>
<h3 id="glue">Glue</h3>
<p>API/Interfaces between components. Virtual machine interface, physical machine interface. High-level abstractions, extends hardware.</p>
<h2 id="kernel">Kernel</h2>
<p>Privileged mode is strictly separated on a hardware level from user mode. Kernel is the part that runs in privileged mode. Microkernels outsource a lot of operations to user mode. Kernel typically event-driven server, reacts on syscalls, interrupts and traps. Applications can use kernel functions via syscalls or a more convenient system library. Kernel should not be bloated -&gt; less bugs, can't get stuck in kernel on heavy load.</p>
<h3 id="system-calls">System Calls</h3>
<p>On syscall, enter privileged mode and return when done. Argument passing varies: As registers, in memory, in stack. System library is declares C functions for syscall.</p>
<h2 id="processes">Processes</h2>
<p>Process is the execution of a program with restricted right, like a VM.</p>
<h3 id="parts">Parts</h3>
<ul>
<li>Virtual Processor: Has address space, registers, instruction pointer, program counter</li>
<li>Proogram text, program data</li>
<li>OS stuff: open files, sockets, CPU share, security rights</li>
</ul>
<h3 id="lifecycle">Lifecycle</h3>
<pre><code>                           preemption
                    ,-----------------------,
                    V                       |
            ,----------------, dispatch ,-------,
created --&gt; |runnable (ready)| -------&gt; |running| --&gt; terminated
            &#39;----------------&#39;          &#39;-------&#39;            
                    ^                       |
                I/O |       ,-------,       | I/O
           comletes &#39;-------|blocked| &lt;-----&#39; operation
                            &#39;-------&#39;</code></pre>
<dl>
<dt>Multiplexing</dt>
<dd>Time- and space-division of processor.
</dd>
<dt>Process Control Block (PCB)</dt>
<dd>In kernel structure, holds name/registers/page table/files, etc.
</dd>
</dl>
<h3 id="creation">Creation</h3>
<p>Explicit (Windows): Syscall with all arguments</p>
<p>Fork/exec: <code>fork</code> current process, copying all arguments (PCB specifically). Use <code>exec</code> to set new binary to execute. Creates process tree (show with <code>pstree</code>)</p>
<p>Example:</p>
<div class="sourceCode"><pre class="sourceCode c"><code class="sourceCode c">pid_t p = fork();
<span class="cf">if</span> (p &lt; <span class="dv">0</span>) {
    <span class="co">// Error</span>
    exit(-<span class="dv">1</span>);
} <span class="cf">else</span> <span class="cf">if</span> (p == <span class="dv">0</span>) {
    <span class="co">// In child</span>
    execlp(<span class="st">&quot;/bin/ls&quot;</span>, <span class="st">&quot;ls&quot;</span>, NULL);
} <span class="cf">else</span> {
    <span class="co">// In parent, `p` is pid of child</span>
    wait(NULL); <span class="co">// Wait for child to complete. Child can&#39;t exit until this is called</span>
    <span class="co">// If not called -&gt; creates zombie child that can&#39;t complete</span>
    exit(<span class="dv">0</span>);
}</code></pre></div>
